import{B as e,C as t,F as n,H as r,M as i,N as a,P as o,Tt as s,Xt as c,it as l,st as u,tt as d,wt as f,yt as p,z as m}from"./vue-C3eY3n8m.js";import{$ as ee,Dt as te,H as ne,Ht as re,Nt as ie,Pt as ae,Q as oe,U as se,V as ce,Vt as le,bt as ue,fn as de,ht as fe,kt as h,nt as g,ot as pe,rn as me,vt as he}from"./antd-CoPH_cEV.js";import{p as _}from"./index-Dx9zetBy.js";import{t as v}from"./crud-operations-CdbZpcU5.js";var ge={style:{"margin-top":`16px`,"text-align":`right`}},_e=[`onClick`],ve=[`onClick`],y=_(r({__name:`index`,setup(r){let _=s([]),y=s(!1),b=s(``),x=s(!1),S=s(null),C=f({section_name:``,course_id:void 0,academic_year:``,semester:`1st`}),w=f({current:1,total:0,pageSize:10}),T=s(!1),E=s(`schedules`),D=s(null),O=s([]),k=s([]),A=s(!1),j=s([]),M=s([]),N=s([]),P=s([]),F=s(!1),I=f({class_schedule_id:void 0,subject_id:void 0,professor_id:void 0,room_id:void 0,day_of_week:void 0,start_time:void 0,end_time:void 0,status:`pending`}),L=s(!1),R=f({student_id:void 0,subject_id:void 0,status:`enrolled`,grade:``}),ye=[{title:`Section`,dataIndex:`section_name`},{title:`Course`,dataIndex:`course_name`},{title:`Academic Year`,dataIndex:`academic_year`},{title:`Semester`,dataIndex:`semester`},{title:`Actions`,dataIndex:`actions`}];function z(e){return[{required:!0,message:`Please input ${e}`}]}async function B(e=w.current){y.value=!0;try{let t=await v.list(`sections`,{search:b.value,page:e,per_page:w.pageSize});_.value=t.data.data??t.data,w.current=t.data.current_page??e,w.total=t.data.total??_.value.length}finally{y.value=!1}}async function V(){let[e,t,n,r]=await Promise.all([v.list(`courses`),v.list(`professors`),v.list(`rooms`),v.list(`subjects`)]);j.value=(e.data?.data??e.data).map(e=>({label:`${e.course_code} - ${e.course_name}`,value:e.course_id})),M.value=(t.data?.data??t.data).map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.professor_id})),N.value=(n.data?.data??n.data).map(e=>({label:`${e.room_number} - ${e.building_name}`,value:e.room_id})),P.value=(r.data?.data??r.data).map(e=>({label:`${e.subject_code} - ${e.subject_name}`,value:e.subject_id}))}function H(e=null){S.value=e,Object.keys(C).forEach(e=>delete C[e]),e&&Object.assign(C,{section_name:e.section_name,course_id:e.course_id,academic_year:e.academic_year,semester:e.semester}),x.value=!0}async function be(){try{S.value?(await v.update(`sections`,S.value.class_section_id,C),h.success(`Section updated`)):(await v.create(`sections`,C),h.success(`Section created`)),x.value=!1,B()}catch(e){let t=e?.response?.data?.errors,n=e?.response?.data?.message||`Error saving section`;t?h.error(Object.values(t).flat().join(`
`)):h.error(n)}}async function xe(e){try{await v.remove(`sections`,e.class_section_id),h.success(`Section deleted`),B()}catch(e){let t=e?.response?.data?.message||`Error deleting`;h.error(t)}}async function Se(e){D.value=e,T.value=!0,E.value=`schedules`,await Promise.all([U(e.class_section_id),W(e.class_section_id)])}async function U(e){try{O.value=(await v.list(`sections/${e}/schedules`)).data}catch{O.value=[]}}async function W(e){A.value=!0;try{k.value=(await v.list(`sections/${e}/students`)).data}finally{A.value=!1}}function G(e=null){Object.keys(I).forEach(e=>delete I[e]),e?Object.assign(I,e):(I.class_section_id=D.value.class_section_id,I.status=`pending`),F.value=!0}async function Ce(){try{let e={...I};I.class_schedule_id?await v.update(`schedules`,I.class_schedule_id,e):await v.create(`schedules`,e),h.success(`Schedule saved`),F.value=!1,await U(D.value.class_section_id)}catch(e){let t=e?.response?.data?.errors,n=e?.response?.data?.message||`Error saving schedule`;t?h.error(Object.values(t).flat().join(`
`)):h.error(n)}}async function we(e){try{await v.remove(`schedules`,e.class_schedule_id),h.success(`Schedule deleted`),U(D.value.class_section_id)}catch{h.error(`Error deleting schedule`)}}function K(e=null){Object.keys(R).forEach(e=>delete R[e]),e?Object.assign(R,{student_id:e.student_id}):R.class_section_id=D.value.class_section_id,L.value=!0}async function Te(){try{h.success(`Student assigned`),L.value=!1,W(D.value.class_section_id)}catch(e){let t=e?.response?.data?.errors,n=e?.response?.data?.message||`Error assigning student`;t?h.error(Object.values(t).flat().join(`
`)):h.error(n)}}async function Ee(e){try{await v.remove(`assignments`,e.assignment_id),h.success(`Assignment removed`),W(D.value.class_section_id)}catch{h.error(`Error removing assignment`)}}function De(e){w.current=e,B(e)}return d(()=>{B(),V()}),(r,s)=>{let d=he,f=me,h=ee,v=oe,V=ne,U=pe,W=fe,q=ae,J=de,Y=ie,X=g,Oe=te,Z=se,Q=re,ke=le,$=ce,Ae=ue;return l(),n(`div`,null,[e(h,{style:{"margin-bottom":`16px`,width:`100%`}},{default:p(()=>[e(d,{value:b.value,"onUpdate:value":s[0]||=e=>b.value=e,placeholder:`Search sections...`,"enter-button":``,style:{"max-width":`300px`},onSearch:s[1]||=()=>{w.current=1,B()}},null,8,[`value`]),e(f,{type:`primary`,onClick:s[2]||=e=>H()},{default:p(()=>[...s[25]||=[m(` Add Section `,-1)]]),_:1})]),_:1}),e(V,{columns:ye,"data-source":_.value,loading:y.value,"row-key":`class_section_id`,bordered:``,pagination:!1},{bodyCell:p(({column:r,record:i})=>[r.dataIndex===`actions`?(l(),a(h,{key:0},{default:p(()=>[e(f,{type:`default`,size:`small`,onClick:e=>H(i)},{default:p(()=>[...s[26]||=[m(` Edit `,-1)]]),_:1},8,[`onClick`]),e(f,{type:`primary`,size:`small`,class:`!bg-blue-600 hover:!bg-blue-700`,onClick:e=>Se(i)},{default:p(()=>[...s[27]||=[m(` Schedules & Students `,-1)]]),_:1},8,[`onClick`]),e(v,{title:`Delete this section?`,"ok-text":`Yes`,"cancel-text":`No`,onConfirm:e=>xe(i)},{default:p(()=>[e(f,{danger:``,size:`small`},{default:p(()=>[...s[28]||=[m(` Delete `,-1)]]),_:1})]),_:1},8,[`onConfirm`])]),_:2},1024)):r.dataIndex===`course_name`?(l(),n(t,{key:1},[m(c(i.course?.course_name||`-`),1)],64)):(l(),n(t,{key:2},[m(c(i[r.dataIndex]),1)],64))]),_:1},8,[`data-source`,`loading`]),i(`div`,ge,[e(U,{current:w.current,total:w.total,"page-size":w.pageSize,"show-total":e=>`Total ${e} sections`,onChange:De},null,8,[`current`,`total`,`page-size`,`show-total`])]),e(X,{open:x.value,"onUpdate:open":s[7]||=e=>x.value=e,title:S.value?`Edit Section`:`Add Section`,onOk:be},{default:p(()=>[e(Y,{model:C,layout:`vertical`},{default:p(()=>[e(q,{label:`Section Name`,name:`section_name`,rules:z(`Section Name`)},{default:p(()=>[e(W,{value:C.section_name,"onUpdate:value":s[3]||=e=>C.section_name=e},null,8,[`value`])]),_:1},8,[`rules`]),e(q,{label:`Course`,name:`course_id`,rules:z(`Course`)},{default:p(()=>[e(J,{value:C.course_id,"onUpdate:value":s[4]||=e=>C.course_id=e,options:j.value,"show-search":``,"option-filter-prop":`label`},null,8,[`value`,`options`])]),_:1},8,[`rules`]),e(q,{label:`Academic Year`,name:`academic_year`,rules:z(`Academic Year`)},{default:p(()=>[e(W,{value:C.academic_year,"onUpdate:value":s[5]||=e=>C.academic_year=e,placeholder:`e.g. 2025-2026`},null,8,[`value`])]),_:1},8,[`rules`]),e(q,{label:`Semester`,name:`semester`,rules:z(`Semester`)},{default:p(()=>[e(J,{value:C.semester,"onUpdate:value":s[6]||=e=>C.semester=e,options:[{label:`1st`,value:`1st`},{label:`2nd`,value:`2nd`},{label:`Summer`,value:`Summer`}]},null,8,[`value`])]),_:1},8,[`rules`])]),_:1},8,[`model`])]),_:1},8,[`open`,`title`]),e(Ae,{open:T.value,"onUpdate:open":s[24]||=e=>T.value=e,title:D.value?`${D.value.section_name} (${D.value.academic_year} ${D.value.semester})`:``,width:`90%`},{default:p(()=>[e(ke,{"active-key":E.value,"onUpdate:activeKey":s[10]||=e=>E.value=e},{default:p(()=>[e(Q,{key:`schedules`,tab:`Schedules`},{default:p(()=>[e(f,{type:`primary`,style:{"margin-bottom":`12px`},onClick:s[8]||=e=>G()},{default:p(()=>[...s[29]||=[m(` Add Schedule `,-1)]]),_:1}),e(V,{"data-source":O.value,"row-key":`class_schedule_id`,bordered:``},{bodyCell:p(({column:r,record:u})=>[r.dataIndex===`subject`?(l(),n(t,{key:0},[m(c(u.subject),1)],64)):r.dataIndex===`professor`?(l(),n(t,{key:1},[m(c(u.professor||`Unassigned`),1)],64)):r.dataIndex===`room`?(l(),n(t,{key:2},[m(c(u.room||`Unassigned`),1)],64)):r.dataIndex===`day_of_week`?(l(),n(t,{key:3},[m(c(u.day_of_week||`Unscheduled`),1)],64)):r.dataIndex===`start_time`?(l(),n(t,{key:4},[m(c(u.start_time?`${u.start_time} - ${u.end_time}`:`Unscheduled`),1)],64)):r.dataIndex===`status`?(l(),a(Oe,{key:5,color:u.status===`finalized`?`green`:`orange`},{default:p(()=>[m(c(u.status),1)]),_:2},1032,[`color`])):r.dataIndex===`actions`?(l(),a(h,{key:6},{default:p(()=>[i(`a`,{onClick:e=>G(u)},`Edit`,8,_e),e(v,{title:`Delete schedule?`,"ok-text":`Yes`,"cancel-text":`No`,onConfirm:e=>we(u)},{default:p(()=>[...s[30]||=[i(`a`,null,`Delete`,-1)]]),_:1},8,[`onConfirm`])]),_:2},1024)):o(``,!0)]),default:p(()=>[e(Z,{title:`Subject`,"data-index":`subject`}),e(Z,{title:`Professor`,"data-index":`professor`}),e(Z,{title:`Room`,"data-index":`room`}),e(Z,{title:`Day`,"data-index":`day_of_week`}),e(Z,{title:`Time`,"data-index":[`start_time`]}),e(Z,{title:`Status`,"data-index":`status`}),e(Z,{title:`Actions`,"data-index":`actions`})]),_:1},8,[`data-source`])]),_:1}),e(Q,{key:`students`,tab:`Students`},{default:p(()=>[e(f,{type:`primary`,style:{"margin-bottom":`12px`},onClick:s[9]||=e=>K()},{default:p(()=>[...s[31]||=[m(` Assign Student `,-1)]]),_:1}),e(V,{"data-source":k.value,loading:A.value,"row-key":`student_id`,bordered:``},{bodyCell:p(({column:r,record:d})=>[r.dataIndex===`student_number`?(l(),n(t,{key:0},[m(c(d.student_number),1)],64)):r.dataIndex===`full_name`?(l(),n(t,{key:1},[m(c(d.first_name)+` `+c(d.last_name),1)],64)):r.dataIndex===`subjects`?(l(!0),n(t,{key:2},u(d.subjects,t=>(l(),n(`div`,{key:t.assignment_id,style:{"margin-bottom":`6px`}},[i(`strong`,null,c(t.subject_code),1),m(` â€” `+c(t.subject_name)+` (`+c(t.status)+`) `,1),e(v,{title:`Remove assignment?`,"ok-text":`Yes`,"cancel-text":`No`,onConfirm:()=>Ee(t)},{default:p(()=>[...s[32]||=[i(`a`,null,`Remove`,-1)]]),_:1},8,[`onConfirm`])]))),128)):r.dataIndex===`actions`?(l(),a(h,{key:3},{default:p(()=>[i(`a`,{onClick:e=>K(d)},`Add Subject`,8,ve)]),_:2},1024)):o(``,!0)]),default:p(()=>[e(Z,{title:`Student #`,"data-index":`student_number`}),e(Z,{title:`Name`,"data-index":`full_name`}),e(Z,{title:`Email`,"data-index":`email`}),e(Z,{title:`Subjects`,"data-index":`subjects`}),e(Z,{title:`Actions`,"data-index":`actions`})]),_:1},8,[`data-source`,`loading`])]),_:1})]),_:1},8,[`active-key`]),e(X,{open:F.value,"onUpdate:open":s[18]||=e=>F.value=e,title:`Schedule`,onOk:Ce},{default:p(()=>[e(Y,{model:I,layout:`vertical`},{default:p(()=>[e(q,{label:`Subject`,rules:z(`Subject`)},{default:p(()=>[e(J,{value:I.subject_id,"onUpdate:value":s[11]||=e=>I.subject_id=e,options:P.value,"show-search":``,"option-filter-prop":`label`},null,8,[`value`,`options`])]),_:1},8,[`rules`]),e(q,{label:`Professor`},{default:p(()=>[e(J,{value:I.professor_id,"onUpdate:value":s[12]||=e=>I.professor_id=e,options:M.value},null,8,[`value`,`options`])]),_:1}),e(q,{label:`Room`},{default:p(()=>[e(J,{value:I.room_id,"onUpdate:value":s[13]||=e=>I.room_id=e,options:N.value},null,8,[`value`,`options`])]),_:1}),e(q,{label:`Day`},{default:p(()=>[e(J,{value:I.day_of_week,"onUpdate:value":s[14]||=e=>I.day_of_week=e,options:[{label:`Monday`,value:`Monday`},{label:`Tuesday`,value:`Tuesday`},{label:`Wednesday`,value:`Wednesday`},{label:`Thursday`,value:`Thursday`},{label:`Friday`,value:`Friday`},{label:`Saturday`,value:`Saturday`}]},null,8,[`value`])]),_:1}),e(q,{label:`Start Time`},{default:p(()=>[e($,{value:I.start_time,"onUpdate:value":s[15]||=e=>I.start_time=e,format:`HH:mm`,style:{width:`100%`}},null,8,[`value`])]),_:1}),e(q,{label:`End Time`},{default:p(()=>[e($,{value:I.end_time,"onUpdate:value":s[16]||=e=>I.end_time=e,format:`HH:mm`,style:{width:`100%`}},null,8,[`value`])]),_:1}),e(q,{label:`Status`},{default:p(()=>[e(J,{value:I.status,"onUpdate:value":s[17]||=e=>I.status=e,options:[{label:`Pending`,value:`pending`},{label:`Finalized`,value:`finalized`}]},null,8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`]),e(X,{open:L.value,"onUpdate:open":s[23]||=e=>L.value=e,title:R.student_id?`Assign Subject`:`Assign Student to Subject`,onOk:Te},{default:p(()=>[e(Y,{model:R,layout:`vertical`},{default:p(()=>[e(q,{label:`Student`,rules:z(`Student`)},{default:p(()=>[e(J,{value:R.student_id,"onUpdate:value":s[19]||=e=>R.student_id=e,options:[],placeholder:`Enter student id or implement search`},null,8,[`value`])]),_:1},8,[`rules`]),e(q,{label:`Subject`,rules:z(`Subject`)},{default:p(()=>[e(J,{value:R.subject_id,"onUpdate:value":s[20]||=e=>R.subject_id=e,options:P.value},null,8,[`value`,`options`])]),_:1},8,[`rules`]),e(q,{label:`Status`},{default:p(()=>[e(J,{value:R.status,"onUpdate:value":s[21]||=e=>R.status=e,options:[{label:`Enrolled`,value:`enrolled`},{label:`Dropped`,value:`dropped`},{label:`Completed`,value:`completed`}]},null,8,[`value`])]),_:1}),e(q,{label:`Grade`},{default:p(()=>[e(W,{value:R.grade,"onUpdate:value":s[22]||=e=>R.grade=e},null,8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`])]),_:1},8,[`open`,`title`])])}}}),[[`__scopeId`,`data-v-831d2174`]]);export{y as default};